<?php

    // Print content type first.
    //
    // Header( "Content-type: image/gif" );

    // Image, font and string data passed through.
    //
    $url_array=explode("/",$REQUEST_URI);

    // First, get the font info.
    //
    $font_info = explode(",", $url_array[3]);
    $font = "/usr/bbs/www/bbs/font/". $font_info[0] .".ttf";
    $size = $font_info[1];

    // Then, get the string to display.
    //
    $text = rawurldecode($url_array[4]);

    // Now, determine the image size we need. The image we are
    // going to create will have 2 pixels border on each side.
    //
    $bounds = ImageTTFBBox( $size, 0, $font, $text );
    $width = abs( $bounds[4] ) + 10;
    $height = abs( $bounds[5] ) + 10;

    if( 0 ) {
    echo "<p>0: $bounds[0]\n";
    echo "<p>1: $bounds[1]\n";
    echo "<p>2: $bounds[2]\n";
    echo "<p>3: $bounds[3]\n";
    echo "<p>4: $bounds[4]\n";
    echo "<p>5: $bounds[5]\n";
    echo "<p>6: $bounds[6]\n";
    echo "<p>7: $bounds[7]\n";

    echo "<p> ";
    echo "<p>H: $height\n";
    echo "<p>W: $width\n";

    }

    // Create the image and set fore and background colours.
    //
    $im = imagecreate( $width, $height );
    $black = ImageColorAllocate( $im, 0, 0, 0 );
    $white = ImageColorAllocate( $im, 255, 255, 255 );

    // Draw the string onto the image.
    //
    ImageTTFText( $im, $size, 0, 5, $height-5, $white, $font, $text );

    // Dump output :)
    //
    ImageGif( $im );

    // Destroy image.
    //
    ImageDestroy( $im );

?>
